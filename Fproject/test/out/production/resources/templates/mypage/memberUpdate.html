<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>정보 수정</title>
</head>
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>

<style>
.input_submit{
   position:relative;
   top:14px;
    display: inline-block;
    font-size: 13px;
    padding: 4px 15px;
    color: white;
    margin: 20px 8px 15px;
    border-radius: 6px;
    text-align: center;
    transition: top .01s linear;
    text-shadow: 0 1px 0 rgb(0 0 0 / 15%);
     text-decoration: none;
       background-color: #AEDBE1;
       box-shadow: 0 0 0 1px #94BABF inset,
             0 0 0 2px rgba(255,255,255,0.15) inset,
             0 4px 0 0 #9EC7CC,
             0 4px 0 1px rgba(0,0,0,0.4),
             0 4px 4px 1px rgba(0,0,0,0.5);
}
.input_submit:active {
  box-shadow: 0 0 0 1px #94BABF inset,
        0 0 0 2px rgba(255,255,255,0.15) inset,
        0 0 0 1px rgba(0,0,0,0.4);
  top:18px;
}
#pwValid{
  border:none;
  display:none;
}

#red{
    color:red;
}
.withdraw{
    position:absolute;
    top: 300px;
   background-color: black;
   color: white;
   cursor: pointer;
   padding: 6px 25px;
   border-radius: 5px;
   display:inline-block;
   width: 94px;
   left:43px;
   vertical-align:middle;
}

#cbtn{
    left:248px;
    width:141px;
}
#texth4{
    position:relative;
    top:47px;
}
.btn-3d {
 position: relative;
 display: inline-block;
 font-size: 13px;
 padding: 4px 15px;
 color: white;
 margin: 20px 8px 15px;
 border-radius: 6px;
 text-align: center;
 transition: top .01s linear;
 text-shadow: 0 1px 0 rgb(0 0 0 / 15%);
  text-decoration: none;
  float:right;
  top: -63px;
}
.btn-3d.red:hover {
    background-color: #AEDBE1;
    color:white;
}

.btn-3d:active {
  top: -59px;
}

/* 3D button colors */
.btn-3d.red {
  background-color: #AEDBE1;
  box-shadow: 0 0 0 1px #94BABF inset,
        0 0 0 2px rgba(255,255,255,0.15) inset,
        0 4px 0 0 #9EC7CC,
        0 4px 0 1px rgba(0,0,0,0.4),
        0 4px 4px 1px rgba(0,0,0,0.5);
}
.btn-3d.red:active {
  box-shadow: 0 0 0 1px #94BABF inset,
        0 0 0 2px rgba(255,255,255,0.15) inset,
        0 0 0 1px rgba(0,0,0,0.4);
}
.modal {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 1254px;
    display: none;
    background-color: rgba(0, 0, 0, 0.4);

}
.modal_body {
  position: absolute;
  top: 25%;
  left: 50%;
  width: 350px;
  height: 350px;
  padding: 40px;
  text-align: center;
  background-color: rgb(255, 255, 255);
  border-radius: 10px;
  box-shadow: 0 2px 3px 0 rgba(34, 36, 38, 0.15);

  transform: translateX(-50%) translateY(-50%);
}
#preview{
   transition-timing-function: ease-in;
}
#preview1{
   display: none;
   z-index: 1;
   position: absolute;
   top: 7%;
   transition: 2s;
   transition-timing-function: ease-in;
   max-height: 500px;
   max-width: 500px;
}

#show2{
   display: none;
   width: 1000px;
   position: relative;
   margin: auto;
}
#show3{
   display: none;
}

tr>td:first-child {
   text-align: right
}

h3 {
   text-align: center;
}
h2 {
   text-align: center;
   position: relative;
}

#edit {
   position: relative;
   font-size: 15px;
   margin-top: 24px;
   height: 38px;
   width: 120px;
   left: 283px;
   background: none;
   border: none;
    color: #fff;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    border-radius: 4px;
    background-color: #98dde3;

}

#profile{
   position: absolute;
   width: 300px;
   height: 300px;
   top: 100px;
   left: -250px;
}
#filebutton {
   display: none;
}

.input_file_button{
   position:relative;
   top:10px;
   cursor: pointer;
   display:inline-block;
   font-size: 15px;
   margin-top: 24px;
   height: 30px;
   width: 120px;
   background: none;
   border: none;
    color: #fff;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    border-radius: 4px;
    background-color: #98dde3;
    padding-top: 8px;
}
#sub{
   display: none;
}
#mboard{
   position:relative;
   height: 300px;
   width: 818px;
   left: 50%;
   margin-left: -400px;
}

.div1 {
   text-align: center;
   vertical-align: middle;
}

.div1-1{
   width: 120px;
   height: 40px;
   margin: auto;
   display: inline-block;
   padding-top: 20px;
   text-align: center;
   align-items: center;
   background-color: rgb(236,236,236);
   border-radius: 10px;
}
#del {
   display: none;
}
.withdraw{
   background-color: black;
   color: white;
   cursor: pointer;
   padding: 6px 25px;
   border-radius: 5px;
   display:inline-block;
   width: 100px
}

.mylabel{
   vertical-align: 5px;
   color: #999;
}
.mydiv{
   padding: 0px 0px 8px 0px;
}
.myinput{
   vertical-align: 5px;
   width:400px;
   height:40px;
   display: inline-block;
   border:none;
   background-color: #F7F7F7;
}
#show1 {
   position:relative;
   width: 400px;
   margin:auto;
   padding:30px
}
.mylist{
   position: relative;
   margin: auto;
   width: 500px;
   height: 150px;
   box-shadow: rgb(31 38 135 / 20%) 0px 8px 32px 0px;
   outline: 5px;
   margin-bottom: 10px;
   border-radius: 4px;
   top: 22px;

}
.mylist:hover{
   transform: scale(1.1) ;
    border: 10px;
    border-color: gray;
    background-color: #FFF4F9;
}
.imgdiv {
   position: relative;
   left: 316px;
   top: 15px;
}
.spannick {
   position: relative;
   top: -40px;
}
.divdate{
   position: absolute;
   bottom: 2%;
   right: 3%;
}
span{
   color: #5075B5;
   font-weight: bold;
}

.divtitle{
   position: absolute;
   top: 10%;
   left: 4%
}

.divregion{
   position: absolute;
   top: 10%;
   left: 58%;
}

.divname{
   position: absolute;
   top: 33%;
   left: 4%;
}

.divcount{
   position: absolute;
   top: 56%;
   left: 4%;

}
a {
   color: black;
}
.favoimg{
   position: relative;
   width:70px;
   height:70px;
    margin: auto;
    top: 32px;

}
.mylist2{
   position: relative;
   margin: auto;
   width: 500px;
   height: 150px;
   box-shadow: rgb(31 38 135 / 20%) 0px 8px 32px 0px;
   outline: 5px;
   margin-bottom: 10px;
   border-radius: 4px;
   top:-70px;

}
.myfavo{
   height: 160px;
   width: 900px;
   position: relative;
   margin: auto;
}
.mylist2:hover{
   transform: scale(1.1) ;
    border: 10px;
    border-color: gray;
    background-color: #FFF4F9;
}
.spanimg{
   position:relative;

   top: 49px;
}
.favodiv{
   position: relative;
   margin: auto;
   height: 150px;
   width: 240px;
   right: 355px;
   top: 78px;
   text-align: center;
}
</style>
<script
        src="https://code.jquery.com/jquery-3.6.2.min.js"
        integrity="sha256-2krYZKh//PcchRtd+H+VyyQoZ/e3EcrkxhM8ycwASPA="
        crossorigin="anonymous"></script>

<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
window.onload = function(){
    document.getElementById("roadFullAddr").addEventListener("click", function(){ //주소입력칸을 클릭하면
        //카카오 지도 발생
        new daum.Postcode({
            oncomplete: function(data) { //선택시 입력값 세팅
                document.getElementById("roadFullAddr").value = data.address; // 주소 넣기
<!--                document.querySelector("input[name=address_detail]").focus(); //상세입력 포커싱-->
            }
        }).open();
    });
}
</script>
<body>

<form action="/members/updateS" method="post" th:object="${sessionMember}" onsubmit="return submit1()">
  <input type="hidden" name=memberId th:field="*{memberId}"/>
  <input type="hidden" th:field="*{createDate}"/>
  <input type="hidden" th:field="*{role}"/>
  <input type="hidden" th:field="*{picture}"/>
  <input id="edit" type="submit" value="저장" >
  <div class="mydiv">
    <label class="mylabel">아이디</label><br/>
    <input class="myinput" type="text" th:field="*{loginId}" readonly>
  </div>
  <div class="mydiv">
    <label class="mylabel">비밀번호</label><br/>
    <input class="myinput" type="password" name="password" id="pw1"th:field="*{loginPw}" onkeyup="passwordCheck()">
  </div>
  <div class="mydiv">
    <label class="mylabel">비밀번호 확인</label><br/>
    <input class="myinput" type="password" name="password1" id="pw2" onkeyup="passwordCheck()"><br>
    <input type="text" id="pwValid">
  </div>
  <div class="mydiv">
    <label class="mylabel">닉네임</label><br/>
    <input class="myinput" type="text" th:field="*{nickname}">
  </div>
  <div class="mydiv">
    <label class="mylabel">이름</label><br/>
    <input class="myinput" type="text" th:field="*{name}">
  </div>
  <div class="mydiv">
    <label class="mylabel">생년월일</label><br/>
    <input class="myinput" type="text"  th:field="*{birthday}">
  </div>
  <div class="mydiv">
    <label class="mylabel">성별</label><br/>
    <input class="myinput" type="text" th:field="*{gender}">
  </div>
  <div class="mydiv">
    <label class="mylabel">전화</label><br/>
    <input class="myinput" type="text" th:field="*{phoneNumber}">
  </div>
  <div class="mydiv">
    <label class="mylabel">이메일</label><br/>
    <input class="myinput" type="text" th:field="*{email}" >
  </div>
  <div class="mydiv">
    <label class="mylabel">주소</label><br/>
    <input class="myinput" id="roadFullAddr" type="text" th:field="*{address}" onClick="openPopup();" >
  </div>
  <div class="mydiv">
    <label class="mylabel">상세주소</label><br/>
    <input class="myinput" type="text" name=address1 >
  </div>
  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
</form>
<form enctype="multipart/form-data" action="/members/profile" method="post">
  <img id="preview" th:src="${info.picture}" width="120px" height="120px" style="border-radius: 50px" onclick="$('#filebutton').trigger('click');">
  <img id="preview1" th:src="${info.picture}" onclick="imgoriginalhidden()">
  <!--  <label class="input_file_button" for="filebutton">사진선택</label>-->
  <input id="filebutton" type="file" name="picture" th:value="*{info.picture}" onchange="imgcg(this)" required><br>
  <label class="input_submit" for="sub">프로필 적용</label>
  <input id="sub" type="submit" value="프로필변경">
  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
</form>
<div class="modal">
  <div class="modal_body">
    <div id="texth4"><h3>정말로</h3><h3 id="red">탈퇴</h3><h3>하시겠습니까?</h3></div>
    <label class="withdraw" for="del" >예</label>
    <form action="/members/delete">
      <input type="submit" id="del">
    </form>
    <button id="cbtn" class="withdraw">아니요</button>
  </div>
</div>
<a class="btn-3d red" id="modalbtn">회원탈퇴</a>
<script>
      const modal = document.querySelector('.modal');
      const btnOpenPopup = document.querySelector('#modalbtn');
      const modalClose = document.querySelector('#cbtn');
      btnOpenPopup.addEventListener('click', () => {
        modal.style.display = 'block';
        window.scrollTo({top: 0});
      });
      modal.addEventListener("click", e => {
      const evTarget = e.target
      if(evTarget.classList.contains("modal")) {
        modal.style.display = "none"
      }});
      modalClose.addEventListener('click', () => {
        modal.style.display = "none";
      });
</script>

</body>
<script>
function passCk(){     

   var popupWidth = 650;
   var popupHeight = 250;

   var popupX = (window.screen.width / 2) - (popupWidth / 2);
   // 만들 팝업창 width 크기의 1/2 만큼 보정값으로 빼주었음

   var popupY= (window.screen.height / 2) - (popupHeight / 2);
   // 만들 팝업창 height 크기의 1/2 만큼 보정값으로 빼주었음

      window.open("http://localhost:8081/SAII/saii/mypage/passcheck.jsp?id="+document.getElementById("userId").value, "chkForm", 
            'width=' + popupWidth + ', height=' + popupHeight + ', resizable=no, scrollbars=no,top=' + popupY + ',left=' + popupX);
   }
function divshow1(){
   document.getElementById("show1").style.display="block";
   document.getElementById("show2").style.display="none";
   document.getElementById("show3").style.display="none";

}
function divshow2(){
   document.getElementById("show1").style.display="none";
   document.getElementById("show2").style.display="block";
   document.getElementById("show3").style.display="none";

}
function divshow3(){
   document.getElementById("show1").style.display="none";
   document.getElementById("show2").style.display="none";
   document.getElementById("show3").style.display="block";

}
function imgcg(input){
   if(input.files && input.files[0]){

      const reader = new FileReader()
        // 이미지가 로드가 된 경우
        reader.onload = function(e) {
            document.getElementById("preview").src=e.target.result;
            document.getElementById("preview1").src=e.target.result;
        };
        // reader가 이미지 읽도록 하기
        reader.readAsDataURL(input.files[0]);
   }else{
      document.getElementById("preview").src="/SAII/Storage/${dto.n_profile_img}";
   }
}
function withdrawcheck(){
   var memberdel = confirm('정말로 탈퇴하시겠습니까?');

   if(memberdel){
      alert('탈퇴됨');
      return true;
   }
   else{
      alert('탈퇴 안했네?');
      return false;
   }
}

function imgoriginal(){
      document.getElementById("preview1").style.display="block";
   }
function imgoriginalhidden(){
   document.getElementById("preview1").style.display="none";
}

function passwordCheck(){
  const pw1=document.getElementById('pw1').value;
  const pw2=document.getElementById('pw2').value;
  if(pw1==pw2){
    document.getElementById('pwValid').style.display="block";
    document.getElementById('pwValid').value="비밀번호 확인";
    document.getElementById('pwValid').style.color="green";
    console.log("비밀번호가 같아?");
    return true;
  }else{
    document.getElementById('pwValid').style.display="block";
    document.getElementById('pwValid').value="비밀번호 다름";
    document.getElementById('pwValid').style.color="red";
    console.log("비밀번호가 달라?");
    return false;
  }
}

function submit1(){
  const pw1=document.getElementById('pw1').value;
  const pw2=document.getElementById('pw2').value;
  if(pw1==pw2){
    console.log("비밀번호 같음");
    return true;
  }else{
    console.log("비밀번호 다름");
    event.preventDefault();
    alert("비밀번호가 다릅니다.")
    return false;
  }
}


</script>
</html>